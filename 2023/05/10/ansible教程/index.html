<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="ansible教程"><meta name="keywords" content="Ansible"><meta name="author" content="慕容峻才"><meta name="copyright" content="慕容峻才"><title>ansible教程 | 阿才的博客</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.4.2'
} </script><meta name="generator" content="Hexo 5.4.2"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85ansible"><span class="toc-number">1.</span> <span class="toc-text">安装ansible</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#yum%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.</span> <span class="toc-text">yum方式安装</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97"><span class="toc-number">2.</span> <span class="toc-text">模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#authorized-key"><span class="toc-number">2.1.</span> <span class="toc-text">authorized_key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#command%E6%A8%A1%E5%9D%97"><span class="toc-number">2.2.</span> <span class="toc-text">command模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#copy%E6%A8%A1%E5%9D%97"><span class="toc-number">2.3.</span> <span class="toc-text">copy模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cron%E6%A8%A1%E5%9D%97"><span class="toc-number">2.4.</span> <span class="toc-text">cron模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-container%E6%A8%A1%E5%9D%97"><span class="toc-number">2.5.</span> <span class="toc-text">docker_container模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#file%E6%A8%A1%E5%9D%97"><span class="toc-number">2.6.</span> <span class="toc-text">file模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fetch%E6%A8%A1%E5%9D%97"><span class="toc-number">2.7.</span> <span class="toc-text">fetch模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#find%E6%A8%A1%E5%9D%97"><span class="toc-number">2.8.</span> <span class="toc-text">find模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#group%E6%A8%A1%E5%9D%97"><span class="toc-number">2.9.</span> <span class="toc-text">group模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lineinfile%E6%A8%A1%E5%9D%97"><span class="toc-number">2.10.</span> <span class="toc-text">lineinfile模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#get-url%E6%A8%A1%E5%9D%97"><span class="toc-number">2.11.</span> <span class="toc-text">get_url模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql-db%E6%A8%A1%E5%9D%97"><span class="toc-number">2.12.</span> <span class="toc-text">mysql_db模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql-user%E6%A8%A1%E5%9D%97"><span class="toc-number">2.13.</span> <span class="toc-text">mysql_user模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#systemd%E6%A8%A1%E5%9D%97"><span class="toc-number">2.14.</span> <span class="toc-text">systemd模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#service%E6%A8%A1%E5%9D%97"><span class="toc-number">2.15.</span> <span class="toc-text">service模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stat%E6%A8%A1%E5%9D%97"><span class="toc-number">2.16.</span> <span class="toc-text">stat模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#template%E6%A8%A1%E5%9D%97"><span class="toc-number">2.17.</span> <span class="toc-text">template模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#user%E6%A8%A1%E5%9D%97"><span class="toc-number">2.18.</span> <span class="toc-text">user模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#wait-for%E6%A8%A1%E5%9D%97"><span class="toc-number">2.19.</span> <span class="toc-text">wait_for模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#yum%E6%A8%A1%E5%9D%97"><span class="toc-number">2.20.</span> <span class="toc-text">yum模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible-filter"><span class="toc-number">3.</span> <span class="toc-text">ansible filter</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible%E5%88%A4%E6%96%AD"><span class="toc-number">4.</span> <span class="toc-text">ansible判断</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#when"><span class="toc-number">4.1.</span> <span class="toc-text">when</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#changed-when"><span class="toc-number">4.2.</span> <span class="toc-text">changed_when</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible%E5%BE%AA%E7%8E%AF"><span class="toc-number">5.</span> <span class="toc-text">ansible循环</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible%E5%8F%98%E9%87%8F"><span class="toc-number">6.</span> <span class="toc-text">ansible变量</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Playbooks"><span class="toc-number">7.</span> <span class="toc-text">Playbooks</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#yml%E8%84%9A%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">7.1.</span> <span class="toc-text">yml脚本语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#playbooks%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86"><span class="toc-number">7.2.</span> <span class="toc-text">playbooks组成部分</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91"><span class="toc-number">8.</span> <span class="toc-text">ansible模块开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5TCP%E7%AB%AF%E5%8F%A3"><span class="toc-number">8.1.</span> <span class="toc-text">检查TCP端口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8E%A5%E5%8F%A3%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE"><span class="toc-number">8.2.</span> <span class="toc-text">调用第三方接口处理数据</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">慕容峻才</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">13</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">11</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">8</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">阿才的博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">首页</a><a class="site-page" href="/archives">时间线</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">ansible教程</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-05-11</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/DevOps/">DevOps</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="安装ansible"><a href="#安装ansible" class="headerlink" title="安装ansible"></a>安装ansible</h1><h2 id="yum方式安装"><a href="#yum方式安装" class="headerlink" title="yum方式安装"></a>yum方式安装</h2><p>导入阿里云epel yum源</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">wget http://mirrors.aliyun.com/repo/epel-7.repo</span><br></pre></td></tr></table></figure>
<p>安装repo</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install ansible python2-pip</span><br></pre></td></tr></table></figure>
<h1 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h1><h2 id="authorized-key"><a href="#authorized-key" class="headerlink" title="authorized_key"></a>authorized_key</h2><blockquote>
<p>管理用户authorized_keys实现免密登陆</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">comment</td>
<td align="left">更改公钥注释</td>
</tr>
<tr>
<td align="left">exclusive</td>
<td align="left">添加或删除authorized_keys</td>
</tr>
<tr>
<td align="left">key</td>
<td align="left">指定公钥</td>
</tr>
<tr>
<td align="left">path</td>
<td align="left">指定authorized_keys路径</td>
</tr>
<tr>
<td align="left">state</td>
<td align="left">如果是present则创建，如果是absent则删除</td>
</tr>
<tr>
<td align="left">user</td>
<td align="left">指定用户名称</td>
</tr>
</tbody></table>
<blockquote>
<p>配置节点k8s用户互信</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config</span> <span class="string">k8s</span> <span class="string">user</span> <span class="string">account</span></span><br><span class="line">  <span class="attr">authorized_key:</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">k8s</span></span><br><span class="line">    <span class="attr">key:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; lookup(&#x27;file&#x27;, &#x27;/home/k8s/.ssh/id_rsa.pub&#x27;) &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">exclusive:</span> <span class="literal">yes</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="command模块"><a href="#command模块" class="headerlink" title="command模块"></a>command模块</h2><table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">creates</td>
<td align="left">一个文件名，当该文件存在则命令不执行</td>
</tr>
<tr>
<td align="left">free_form</td>
<td align="left">要执行的Linux指令</td>
</tr>
<tr>
<td align="left">chdir</td>
<td align="left">在执行指令之前，先切换到该指定的目录</td>
</tr>
<tr>
<td align="left">removes</td>
<td align="left">一个文件名，如果文件不存在，则该选项不执行</td>
</tr>
<tr>
<td align="left">state</td>
<td align="left">如果是present则创建，如果是absent则删除</td>
</tr>
<tr>
<td align="left">user</td>
<td align="left">指定用户名称</td>
</tr>
</tbody></table>
<h2 id="copy模块"><a href="#copy模块" class="headerlink" title="copy模块"></a>copy模块</h2><p>参数</p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">src</td>
<td align="left">源文件</td>
</tr>
<tr>
<td align="left">dest</td>
<td align="left">目标路径</td>
</tr>
<tr>
<td align="left">backup</td>
<td align="left">覆盖前是否备份原文件</td>
</tr>
<tr>
<td align="left">owner</td>
<td align="left">设置文件目录的属主</td>
</tr>
<tr>
<td align="left">group</td>
<td align="left">设置文件目录的属组</td>
</tr>
<tr>
<td align="left">mode</td>
<td align="left">设置文件目录的权限</td>
</tr>
</tbody></table>
<h2 id="cron模块"><a href="#cron模块" class="headerlink" title="cron模块"></a>cron模块</h2><table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">backup</td>
<td align="left">对远程主机上原任务计划内容修改之前备份</td>
</tr>
<tr>
<td align="left">day</td>
<td align="left">日</td>
</tr>
<tr>
<td align="left">hour</td>
<td align="left">小时</td>
</tr>
<tr>
<td align="left">minute</td>
<td align="left">分钟</td>
</tr>
<tr>
<td align="left">month</td>
<td align="left">月</td>
</tr>
<tr>
<td align="left">weekday</td>
<td align="left">周</td>
</tr>
<tr>
<td align="left">job</td>
<td align="left">要执行的文件，依赖于state=present</td>
</tr>
<tr>
<td align="left">name</td>
<td align="left">该任务的描述</td>
</tr>
<tr>
<td align="left">special_time</td>
<td align="left">指定什么时候执行（参数：reboot、yearly、annually、monthly、weekly、daily、hourly）</td>
</tr>
<tr>
<td align="left">state</td>
<td align="left">确认该任务计划是创建还是删除</td>
</tr>
<tr>
<td align="left">user</td>
<td align="left">以哪个用户的身份执行</td>
</tr>
</tbody></table>
<blockquote>
<p>创建一个计划任务</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">cron</span> <span class="string">job</span></span><br><span class="line">  <span class="attr">cron:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cron_test</span></span><br><span class="line">    <span class="attr">minute:</span> <span class="string">&quot;*/3&quot;</span></span><br><span class="line">    <span class="attr">hour:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">    <span class="attr">day:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">    <span class="attr">month:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">    <span class="attr">weekday:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">    <span class="attr">job:</span> <span class="string">&quot;/usr/sbin/ntpdate cn.ntp.org.cn&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="docker-container模块"><a href="#docker-container模块" class="headerlink" title="docker_container模块"></a>docker_container模块</h2><table>
<thead>
<tr>
<th>参数</th>
<th>可选项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>command</td>
<td></td>
<td>容器启动时执行的命令可以是字符串，也可以是列表</td>
</tr>
<tr>
<td>hostname</td>
<td></td>
<td>容器hostname</td>
</tr>
<tr>
<td>image</td>
<td></td>
<td>容器镜像</td>
</tr>
<tr>
<td>name</td>
<td></td>
<td>容器名称</td>
</tr>
<tr>
<td>env</td>
<td></td>
<td>容器环境变量</td>
</tr>
<tr>
<td>network_mode</td>
<td>bridge、host、none</td>
<td>容器的网络模式</td>
</tr>
<tr>
<td>pull</td>
<td></td>
<td>下载镜像到本地</td>
</tr>
<tr>
<td>read_only</td>
<td></td>
<td>挂载容器根文件系统为只读</td>
</tr>
<tr>
<td>restart</td>
<td></td>
<td>重启容器</td>
</tr>
<tr>
<td>restart_policy</td>
<td>no、on-failure、always、unless-stopped</td>
<td>重启容器策略</td>
</tr>
<tr>
<td>state</td>
<td>absent、present、stopped、started</td>
<td>容器运行状态</td>
</tr>
<tr>
<td>volume_driver</td>
<td></td>
<td>volume driver</td>
</tr>
<tr>
<td>volumes</td>
<td></td>
<td>容器共享宿主机的目录，例如：volumes: /opt:container:/opt</td>
</tr>
</tbody></table>
<blockquote>
<p>创建容器</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">docker</span> <span class="string">registry</span></span><br><span class="line">  <span class="attr">docker_container:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">registry</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry:2</span></span><br><span class="line">    <span class="attr">ports:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="number">4000</span><span class="string">:5000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">80</span><span class="string">:80</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">restart_policy:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">/opt/t2cp:/var/lib/registry</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/test:/etc/test</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>重启容器</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">docker</span> <span class="string">registry</span></span><br><span class="line">  <span class="attr">docker_container:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">registry</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry:2</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="literal">yes</span></span><br><span class="line">    <span class="attr">ports:</span> <span class="number">4000</span><span class="string">:5000</span></span><br></pre></td></tr></table></figure>
<h2 id="file模块"><a href="#file模块" class="headerlink" title="file模块"></a>file模块</h2><table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">group</td>
<td align="left">定义文件/目录属组</td>
</tr>
<tr>
<td align="left">owner</td>
<td align="left">定义文件目录属主</td>
</tr>
<tr>
<td align="left">mode</td>
<td align="left">定义文件目录的权限</td>
</tr>
<tr>
<td align="left">owner</td>
<td align="left">设置文件目录的属主</td>
</tr>
<tr>
<td align="left">path</td>
<td align="left">定义文件目录的路径</td>
</tr>
<tr>
<td align="left">recurse</td>
<td align="left">递归设置文件的属性，只对目录有效</td>
</tr>
<tr>
<td align="left">state</td>
<td align="left">定义文件状态（state状态有三个选项directory：如果目录不存在则创建、touch：如果文件不存在则创建、absent：删除文件或目录）</td>
</tr>
</tbody></table>
<h2 id="fetch模块"><a href="#fetch模块" class="headerlink" title="fetch模块"></a>fetch模块</h2><p>从远程主机复制文件到本地</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>src</td>
<td>源文件</td>
</tr>
<tr>
<td>dest</td>
<td>目标文件</td>
</tr>
<tr>
<td>flat</td>
<td>如果dest的路径以/结尾保存在相对路径目录下</td>
</tr>
</tbody></table>
<blockquote>
<p>目标节点拉取配置文件到ansible节点</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">ceph</span> <span class="string">config</span> <span class="string">to</span> <span class="string">tmp</span> <span class="string">dir</span></span><br><span class="line">  <span class="attr">fetch:</span></span><br><span class="line">    <span class="attr">src:</span> <span class="string">/tmp/ceph.conf</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">/tmp/ceph.conf</span></span><br><span class="line">    <span class="attr">flat:</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>
<h2 id="find模块"><a href="#find模块" class="headerlink" title="find模块"></a>find模块</h2><p>find模块可以帮助我们在远程主机查找符合条件的文件，类似与linux操作系统find命令。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>paths</td>
<td>指定文件路径，可以指定多个路径，路径间用逗号隔开</td>
</tr>
<tr>
<td>recurse</td>
<td>当 recurse 参数设置为 yes 时，表示在指定目录中递归的查找文件</td>
</tr>
<tr>
<td>hidden</td>
<td>当 hidden 参数的值设置为 yes 时，才会查找隐藏文件</td>
</tr>
<tr>
<td>file_type</td>
<td>指定查找文件类型，可指定的文件类型有 any、directory、file、link 四种</td>
</tr>
<tr>
<td>contains</td>
<td>根据文章内容查找文件，此参数的值为一个正则表达式，find 模块会根据对应的正则表达式匹配文件内容。</td>
</tr>
<tr>
<td>age</td>
<td>根据时间范围查找文件，可以使用的单位有秒(s)、分(m)、时(h)、天(d)、星期(w)</td>
</tr>
<tr>
<td>age_stamp</td>
<td>文件的时间属性有三种，atime、ctime、mtime，当我们根据时间范围查找文件时，可以指定以哪个时间种类</td>
</tr>
<tr>
<td>size</td>
<td>指定查找文件的大小，可以使用的单位有 t、g、m、k、b</td>
</tr>
</tbody></table>
<h2 id="group模块"><a href="#group模块" class="headerlink" title="group模块"></a>group模块</h2><p>用户组管理</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>值</th>
</tr>
</thead>
<tbody><tr>
<td><code>name</code></td>
<td>用户名</td>
</tr>
<tr>
<td><code>state</code></td>
<td>创建或删除</td>
</tr>
<tr>
<td><code>groups</code></td>
<td>用户组</td>
</tr>
<tr>
<td><code>uid</code></td>
<td>用户UID</td>
</tr>
<tr>
<td><code>password</code></td>
<td>用户密码</td>
</tr>
<tr>
<td><code>home</code></td>
<td>指定家目录，需要<code>createhome</code>为<code>yes</code></td>
</tr>
<tr>
<td><code>createhome</code></td>
<td>是否创建家目录</td>
</tr>
<tr>
<td><code>system</code></td>
<td>是否创建为系统用户</td>
</tr>
<tr>
<td><code>remove</code></td>
<td>当<code>state=absent</code>时，删除家目录</td>
</tr>
<tr>
<td><code>shell</code></td>
<td>指定用户shell环境</td>
</tr>
</tbody></table>
<blockquote>
<p>创建用户组</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">a</span> <span class="string">group</span> <span class="string">named</span> <span class="string">acai</span> <span class="string">with</span> <span class="string">a</span> <span class="string">GID</span> <span class="string">of</span> <span class="number">2016</span></span><br><span class="line">  <span class="attr">group:</span></span><br><span class="line">    <span class="attr">gid:</span> <span class="number">2016</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">acai</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">user</span> <span class="string">test_user</span> <span class="string">and</span> <span class="string">add</span> <span class="string">to</span> <span class="string">acai</span> <span class="string">group</span></span><br><span class="line">  <span class="attr">user:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">test_user</span></span><br><span class="line">    <span class="attr">groups:</span> <span class="string">acai</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br></pre></td></tr></table></figure>
<h2 id="lineinfile模块"><a href="#lineinfile模块" class="headerlink" title="lineinfile模块"></a>lineinfile模块</h2><p>该模块用于从一个文件中搜索一行，确保该行存在或删除该行。lineinfile模块主要用于改变一个文件的一行。如果想要改变文件中相似的多行，可以使用replace模块。如果想要插入/更新/删除一个行块，可以使用blockinfile模块。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>backup</td>
<td>用于创建一个包含时间戳信息的备份文件。以便在错误的修改了文件的时候，能够找回原始的文件。</td>
</tr>
<tr>
<td>create</td>
<td>与state=present一起使用。如果指定了这个参数，当要修改的文件不存在的时候，会创建它。否则会报错。</td>
</tr>
<tr>
<td>dest</td>
<td>要修改的文件</td>
</tr>
<tr>
<td>insertbefore</td>
<td>当regexp不匹配文件中的任何行的时候，会将line参数所指定的行，插入到insertbefore所指定的正则表达式匹配的行中的最后一行的前面，当insertbefore所指定的正则表达式不匹配任何行时，会插入到文件的末尾</td>
</tr>
<tr>
<td>insertafter</td>
<td>与insertbefore类似，不同的是，insertbefore会将新行插入到其所指定的正则表达式匹配的行中的最后一行的前面，而insertafter是插入到后面。</td>
</tr>
<tr>
<td>line</td>
<td>要插入或者替换的行。如果设置了backrefs参数，那么line中可以包含 位置分组 或 命名分组，lineinfile模块会使用regexp捕获的分组填充它们。</td>
</tr>
<tr>
<td>mode</td>
<td>用来指定文件的权限，比如mode=0644 或 mode=’a+x’</td>
</tr>
<tr>
<td>owner 和 group</td>
<td>用来指定文件的属主 和 属组</td>
</tr>
<tr>
<td>regexp</td>
<td>用于搜索文件中的每一行的正则表达式。对于state=present，这个正则表达式所匹配的行中的最后一行会被替换；对于state=present，会删除所有匹配的行。</td>
</tr>
<tr>
<td>state</td>
<td>用于设置 新增或替换一行，还是删除行</td>
</tr>
</tbody></table>
<blockquote>
<p>删除password文件开头为root的行</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">delete</span> <span class="string">line</span> <span class="string">for</span> <span class="string">root</span> <span class="string">in</span> <span class="string">password</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">&#x27;/etc/password&#x27;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">absent</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&#x27;^root&#x27;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>关闭selinux</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">disable</span> <span class="string">selinux</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">&#x27;/etc/selinux/config&#x27;</span></span><br><span class="line">    <span class="attr">regexp:</span> <span class="string">&#x27;^SELINUX=.*&#x27;</span></span><br><span class="line">    <span class="attr">line:</span> <span class="string">&#x27;SELINUX=disabled&#x27;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>添加hosts解析</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">add</span> <span class="string">hosts</span></span><br><span class="line">  <span class="attr">lineinfile:</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">&#x27;/etc/hosts&#x27;</span></span><br><span class="line">    <span class="attr">line:</span> <span class="string">&#x27;172.16.1.10\ttest&#x27;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br></pre></td></tr></table></figure>
<h2 id="get-url模块"><a href="#get-url模块" class="headerlink" title="get_url模块"></a>get_url模块</h2><blockquote>
<p>下载文件到/tmp</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">download</span> <span class="string">file</span> <span class="string">to</span> <span class="string">/tmp</span> <span class="string">directory</span></span><br><span class="line">  <span class="attr">get_url:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">&#x27;http://mirrors.aliyun.com/centos/timestamp.txt&#x27;</span></span><br><span class="line">    <span class="attr">dest:</span> <span class="string">&#x27;/tmp&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="mysql-db模块"><a href="#mysql-db模块" class="headerlink" title="mysql_db模块"></a>mysql_db模块</h2><blockquote>
<p>导入sql</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">import</span> <span class="string">register.sql</span> <span class="string">for</span> <span class="string">harbor</span> </span><br><span class="line">  <span class="attr">mysql_db:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; mysql_db_name &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">import</span></span><br><span class="line">    <span class="attr">target:</span> <span class="string">/tmp/registry.sql</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">inventory_hostname</span> <span class="string">in</span> <span class="string">groups[&#x27;harbor_nodes&#x27;][0]</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>创建数据库</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">database</span> <span class="string">for</span> <span class="string">harbor</span></span><br><span class="line">  <span class="attr">mysql_db:</span></span><br><span class="line">     <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; mysql_db_name &#125;&#125;</span>&quot;</span></span><br><span class="line">     <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">  <span class="attr">run_once:</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>

<h2 id="mysql-user模块"><a href="#mysql-user模块" class="headerlink" title="mysql_user模块"></a>mysql_user模块</h2><table>
<thead>
<tr>
<th>参数</th>
<th>可选值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>append_privs</td>
<td></td>
<td>用户添加权限，不会覆盖原有权限</td>
</tr>
<tr>
<td>config_file</td>
<td></td>
<td>指定user和passwd配置文件</td>
</tr>
<tr>
<td>connect_timeout</td>
<td></td>
<td>连接数据库超时时间</td>
</tr>
<tr>
<td>host</td>
<td></td>
<td>mysql的IP或是主机名称</td>
</tr>
<tr>
<td>login_host</td>
<td></td>
<td>登陆mysql的主机名称</td>
</tr>
<tr>
<td>login_password</td>
<td></td>
<td>登陆mysql的用户密码</td>
</tr>
<tr>
<td>login_user</td>
<td></td>
<td>登陆mysql的用户</td>
</tr>
<tr>
<td>state</td>
<td>present/absent</td>
<td></td>
</tr>
<tr>
<td>name</td>
<td></td>
<td>用户名</td>
</tr>
<tr>
<td>password</td>
<td></td>
<td>密码</td>
</tr>
<tr>
<td>priv</td>
<td></td>
<td>访问权限</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p>创建mysql远程用户</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">harbor</span> <span class="string">remote</span> <span class="string">user</span> <span class="string">for</span> <span class="string">mysql</span> <span class="string">database</span></span><br><span class="line">  <span class="attr">mysql_user:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; mysql_harbor_user &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; mysql_harbor_pass &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">&quot;%&quot;</span></span><br><span class="line">    <span class="attr">priv:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; mysql_db_name &#125;&#125;</span>.*:ALL&quot;</span></span><br><span class="line">    <span class="attr">append_privs:</span> <span class="string">&quot;yes&quot;</span></span><br><span class="line">  <span class="attr">run_once:</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>
<h2 id="systemd模块"><a href="#systemd模块" class="headerlink" title="systemd模块"></a>systemd模块</h2><p>systemd模块就是使用systemctl来管理centos7系统服务</p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>可选值</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td>yes/no</td>
<td>服务名称</td>
</tr>
<tr>
<td>enabled</td>
<td>yes/no</td>
<td>是否设置开机启动</td>
</tr>
<tr>
<td>state</td>
<td>started、stopped、restarted、reload</td>
<td>对服务执行的动作</td>
</tr>
</tbody></table>
<h2 id="service模块"><a href="#service模块" class="headerlink" title="service模块"></a>service模块</h2><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>enabled</td>
<td>是否开机启动 yes/no</td>
</tr>
<tr>
<td>name</td>
<td>服务名称</td>
</tr>
<tr>
<td>runlevel</td>
<td>运行级别</td>
</tr>
<tr>
<td>sleep</td>
<td>如果执行了restarted，在stop和start之间沉睡几秒</td>
</tr>
<tr>
<td>state</td>
<td>对服务执行启动，停止，重启，重新加载等</td>
</tr>
</tbody></table>
<blockquote>
<p>启动apache服务设置开机自动启动</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">startup</span> <span class="string">apache</span> <span class="string">service</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>
<h2 id="stat模块"><a href="#stat模块" class="headerlink" title="stat模块"></a>stat模块</h2><p>索引文件、目录的状态</p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">可选项</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="left">path</td>
<td align="left"></td>
<td align="left">文件、目录路径</td>
</tr>
</tbody></table>
<p>返回值</p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">可选项</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="left">atime</td>
<td align="left"></td>
<td align="left">返回最后一次访问文件的时间</td>
</tr>
<tr>
<td align="left">attributes</td>
<td align="left"></td>
<td align="left">返回属性</td>
</tr>
<tr>
<td align="left">exists</td>
<td align="left"></td>
<td align="left">路径是否存在</td>
</tr>
<tr>
<td align="left">ischr</td>
<td align="left"></td>
<td align="left">返回是否为设备</td>
</tr>
<tr>
<td align="left">isdir</td>
<td align="left"></td>
<td align="left">返回是否为目录</td>
</tr>
<tr>
<td align="left">islnk</td>
<td align="left"></td>
<td align="left">返回是否为链接</td>
</tr>
<tr>
<td align="left">isuid</td>
<td align="left"></td>
<td align="left">返回uid</td>
</tr>
<tr>
<td align="left">mode</td>
<td align="left"></td>
<td align="left">返回文件权限</td>
</tr>
<tr>
<td align="left">mtime</td>
<td align="left"></td>
<td align="left">返回最后修改时间</td>
</tr>
<tr>
<td align="left">readable</td>
<td align="left"></td>
<td align="left">返回是否有可读权限</td>
</tr>
<tr>
<td align="left">size</td>
<td align="left"></td>
<td align="left">返回文件字节大小</td>
</tr>
</tbody></table>
<h2 id="template模块"><a href="#template模块" class="headerlink" title="template模块"></a>template模块</h2><p>template使用了Jinjia2格式作为文件模版，进行文档内变量的替换的模块。</p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">可选项</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="left">backup</td>
<td align="left">yes/no</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">src</td>
<td align="left"></td>
<td align="left">文件源地址</td>
</tr>
<tr>
<td align="left">dest</td>
<td align="left"></td>
<td align="left">文件目的地址</td>
</tr>
<tr>
<td align="left">mode</td>
<td align="left"></td>
<td align="left">设置远程节点上的template文件权限。类似Linux中chmod的用法</td>
</tr>
<tr>
<td align="left">owner</td>
<td align="left"></td>
<td align="left">设置远程节点上的template文件所属用户</td>
</tr>
<tr>
<td align="left">group</td>
<td align="left"></td>
<td align="left">设置远程节点上的的template文件的所属用户组</td>
</tr>
</tbody></table>
<blockquote>
<p>创建chrony.conf.j2模版</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">allow &#123;&#123; cluster_network &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>在templates目录下创建chrony.conf.j2文件并替换以下变量<br>allow </p>
 代表是由ansible引入的一个变量，该变量可在group_vars目录下文件中调用，eg：
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> group_vars/all </span><br><span class="line">---</span><br><span class="line"><span class="comment">#k8s cluster api network</span></span><br><span class="line"><span class="comment">#eg: cluster_network : 192.168.1.0/24</span></span><br><span class="line">cluster_network : 192.168.1.0/24</span><br></pre></td></tr></table></figure>
<p>当ansible执行该任务后，被copy的配置文件会被替换为cluster_network变量的值。</p>
<h2 id="user模块"><a href="#user模块" class="headerlink" title="user模块"></a>user模块</h2><table>
<thead>
<tr>
<th>参数</th>
<th>可选值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>append</td>
<td>yes/no</td>
<td></td>
</tr>
<tr>
<td>comment</td>
<td></td>
<td></td>
</tr>
<tr>
<td>create_home</td>
<td>yes/no</td>
<td></td>
</tr>
<tr>
<td>expires</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="wait-for模块"><a href="#wait-for模块" class="headerlink" title="wait_for模块"></a>wait_for模块</h2><p>当我们启动一个服务或是执行某条shell的时候，你想确认下服务或是shell是否执行成功。这时候就需要使用wait_for模块。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>connect_timeout</td>
<td>在下一个事情发生前等待连接的时间</td>
</tr>
<tr>
<td>delay</td>
<td>延时</td>
</tr>
<tr>
<td>host</td>
<td>执行模块的host</td>
</tr>
<tr>
<td>path</td>
<td>当一个文件存在时，继续下一步</td>
</tr>
<tr>
<td>port</td>
<td>监测端口</td>
</tr>
<tr>
<td>state</td>
<td>started 当对象是端口的时候确保端口是打开的；对象是文件时，确认文件是否存在<br />stopped 对象是端口的时候确保端口是关闭的；<br />present 对象是文件的时候确保文件是存在的；<br />absent 对象是文件的时候确保文件是不存在的</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p>检查某个节点端口是否正常访问</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">check</span> <span class="string">nginx</span> <span class="string">port</span> <span class="string">for</span> <span class="string">yum</span> <span class="string">repo</span></span><br><span class="line">  <span class="attr">wait_for:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; yum_port &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; deploy_node_address &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">run_once:</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>
<h2 id="yum模块"><a href="#yum模块" class="headerlink" title="yum模块"></a>yum模块</h2><table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>enablerepo</td>
<td>激活yum源</td>
</tr>
<tr>
<td>name</td>
<td>要操作软件包的名字，也可以传递一个url和本地路径</td>
</tr>
<tr>
<td>state</td>
<td>定义软件包的状态（present：安装、absent：删除、latest：安装最新的）</td>
</tr>
</tbody></table>
<blockquote>
<p>安装apache服务</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">apache</span></span><br><span class="line">  <span class="attr">yum:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">    <span class="attr">state:</span> <span class="string">present</span></span><br></pre></td></tr></table></figure>

<h1 id="ansible-filter"><a href="#ansible-filter" class="headerlink" title="ansible filter"></a>ansible filter</h1><p>当涉及到 Ansible 的 Filter 时，有一些内置 Filter 是很常用的。下面是一些常见的 Filter：</p>
<table>
<thead>
<tr>
<th>Filter 名称</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>abs</code></td>
<td>返回一个数字的绝对值</td>
</tr>
<tr>
<td><code>basename</code></td>
<td>返回一个路径的最后一部分</td>
</tr>
<tr>
<td><code>bool</code></td>
<td>返回一个布尔值</td>
</tr>
<tr>
<td><code>default</code></td>
<td>如果变量未定义或为空，则返回一个默认值</td>
</tr>
<tr>
<td><code>difference</code></td>
<td>返回两个列表之间的差异</td>
</tr>
<tr>
<td><code>filesizeformat</code></td>
<td>格式化字节大小，如 1MB</td>
</tr>
<tr>
<td><code>first</code></td>
<td>返回列表的第一个元素</td>
</tr>
<tr>
<td><code>from_json</code></td>
<td>将 JSON 字符串转换为 Python 对象</td>
</tr>
<tr>
<td><code>from_yaml</code></td>
<td>将 YAML 字符串转换为 Python 对象</td>
</tr>
<tr>
<td><code>join</code></td>
<td>将列表中的元素连接为一个字符串</td>
</tr>
<tr>
<td><code>last</code></td>
<td>返回列表的最后一个元素</td>
</tr>
<tr>
<td><code>length</code></td>
<td>返回列表、字典或字符串的长度</td>
</tr>
<tr>
<td><code>lower</code></td>
<td>将字符串转换为小写</td>
</tr>
<tr>
<td><code>max</code></td>
<td>返回列表中的最大值</td>
</tr>
<tr>
<td><code>min</code></td>
<td>返回列表中的最小值</td>
</tr>
<tr>
<td><code>random</code></td>
<td>返回列表中的随机元素</td>
</tr>
<tr>
<td><code>reject</code></td>
<td>返回列表中不满足指定条件的元素</td>
</tr>
<tr>
<td><code>replace</code></td>
<td>将字符串中的一个子串替换为另一个子串</td>
</tr>
<tr>
<td><code>select</code></td>
<td>返回列表中满足指定条件的元素</td>
</tr>
<tr>
<td><code>sort</code></td>
<td>对列表进行排序</td>
</tr>
<tr>
<td><code>sum</code></td>
<td>返回列表中所有数字的和</td>
</tr>
<tr>
<td><code>to_json</code></td>
<td>将 Python 对象转换为 JSON 字符串</td>
</tr>
<tr>
<td><code>to_yaml</code></td>
<td>将 Python 对象转换为 YAML 字符串</td>
</tr>
<tr>
<td><code>trim</code></td>
<td>移除字符串开头和结尾的空白字符</td>
</tr>
<tr>
<td><code>union</code></td>
<td>返回两个列表的并集</td>
</tr>
<tr>
<td><code>unique</code></td>
<td>返回一个列表中的唯一元素</td>
</tr>
<tr>
<td><code>upper</code></td>
<td>将字符串转换为大写</td>
</tr>
<tr>
<td><code>urlencode</code></td>
<td>对字符串进行 URL 编码</td>
</tr>
<tr>
<td><code>version</code></td>
<td>将版本号字符串转换为可比较的形式</td>
</tr>
</tbody></table>
<blockquote>
<p>将字符串开头和结尾的空格去除</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">debug</span> <span class="string">k8s</span> <span class="string">cluster</span> <span class="string">system</span> <span class="string">id</span></span><br><span class="line">  <span class="attr">debug:</span></span><br><span class="line">    <span class="attr">msg:</span> <span class="string">&quot;k8s cluster System Id is: <span class="template-variable">&#123;&#123; System_Id.stdout|trim &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>替换字符串，将192.168.1.1替换为192-168-1-1</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">get</span> <span class="string">kube</span> <span class="string">etcd</span> <span class="string">pem</span> <span class="string">for</span> <span class="string">prometheus</span></span><br><span class="line">  <span class="attr">command:</span> <span class="string">cat</span> <span class="string">/etc/kubernetes/ssl/kube-etcd-&#123;&#123;</span> <span class="string">hostvars[inventory_hostname][&#x27;ansible_&#x27;</span> <span class="string">+</span> <span class="string">api_interface][&#x27;ipv4&#x27;][&#x27;address&#x27;]</span> <span class="string">|</span> <span class="string">regex_replace(&#x27;\.&#x27;,</span> <span class="string">&#x27;-&#x27;</span><span class="string">)</span> <span class="string">&#125;&#125;.pem</span></span><br><span class="line">  <span class="attr">register:</span> <span class="string">kube_etcd_pem</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">inventory_hostname</span> <span class="string">in</span>  <span class="string">groups[&#x27;cp_control&#x27;][0]</span> </span><br></pre></td></tr></table></figure>

<h1 id="ansible判断"><a href="#ansible判断" class="headerlink" title="ansible判断"></a>ansible判断</h1><table>
<thead>
<tr>
<th>判断类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>when</td>
<td>在任务运行之前用于评估是否需要运行任务</td>
</tr>
<tr>
<td>assert</td>
<td>如果表达式不为真，则任务失败</td>
</tr>
<tr>
<td>failed_when</td>
<td>当一个任务的返回码符合给定的条件时，将标记任务失败</td>
</tr>
<tr>
<td>changed_when</td>
<td>如果命令的执行返回值符合给定的条件，则将结果标记为已更改</td>
</tr>
</tbody></table>
<h2 id="when"><a href="#when" class="headerlink" title="when"></a>when</h2><blockquote>
<p>when条件判断：只条满足when的条件时才执行对应的tasks</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">master</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test</span> <span class="string">host</span> <span class="string">IP</span> <span class="string">address</span></span><br><span class="line">    <span class="attr">debug:</span> <span class="string">&#x27;msg=&quot;<span class="template-variable">&#123;&#123; ansible_default_ipv4.address &#125;&#125;</span>&quot;&#x27;</span></span><br><span class="line">    <span class="attr">when:</span> <span class="string">ansible_default_ipv4.address</span> <span class="string">==</span> <span class="string">&quot;192.168.1.11&quot;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>判断chrony配置文件是否存在，如果存在则跳过；如果不存在则复制配置文件</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">chrony</span> <span class="string">check</span> <span class="string">is</span> <span class="string">exits</span></span><br><span class="line">  <span class="attr">stat:</span> <span class="string">path=/etc/chrony.conf.bak</span></span><br><span class="line">  <span class="attr">register:</span> <span class="string">chrony_conf_status</span></span><br><span class="line">  <span class="comment">#先用register获取chrony.conf.bak文件的状态</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">backup</span> <span class="string">chrony</span> <span class="string">conf</span></span><br><span class="line">  <span class="attr">copy:</span> <span class="string">src=/etc/chrony.conf</span> <span class="string">dest=/etc/chrony.conf.bak</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">chrony_conf_status.stat.exists</span> <span class="string">==</span> <span class="literal">False</span></span><br><span class="line">  <span class="comment">#判断配置文件是否存在如果存在则不执行该task</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>定义变量判断：</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">cloudkitty_hashmaps:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; cloudkitty_hashmaps_cp if deloy_cp_region is defined and deploy_cp_region|bool  else cloudkitty_hashmaps_os &#125;&#125;</span></span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>判断regsiter变量的值，如果两个节点及以上register变量相等，则执行task</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mariadb</span> <span class="string">galera</span> <span class="string">cluster</span> <span class="string">first</span> <span class="string">startup</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">galera_new_cluster</span> <span class="string">&gt;&gt;/dev/null</span></span><br><span class="line">  <span class="attr">ignore_errors:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">when:</span> &#123;&#123; <span class="string">safe_to_bootstrap.stdout</span> &#125;&#125;<span class="string">|int</span> <span class="string">&gt;=1</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>判断变量cattle_system_ns_state的结果如果为failed则执行create ns cattle-system任务</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">check</span> <span class="string">cattle-system</span> <span class="string">namespace</span> <span class="string">is</span> <span class="string">exists</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">kubectl</span> <span class="string">get</span> <span class="string">ns|grep</span> <span class="string">cattle-system</span></span><br><span class="line">  <span class="attr">register:</span> <span class="string">cattle_system_ns_state</span></span><br><span class="line">  <span class="attr">ignore_errors:</span> <span class="literal">True</span></span><br><span class="line">  <span class="attr">run_once:</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">namespace</span> <span class="string">cattle-system</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">kubectl</span> <span class="string">create</span> <span class="string">namespace</span> <span class="string">cattle-system</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">cattle_system_ns_state</span> <span class="string">|</span> <span class="string">failed</span></span><br><span class="line">  <span class="attr">run_once:</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h2 id="changed-when"><a href="#changed-when" class="headerlink" title="changed_when"></a>changed_when</h2><blockquote>
<p>先执行task,并对task返回的值进行判断，当满足changed_when指定的条件时说明是执行成功的</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">master</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">check</span> <span class="string">hostname</span></span><br><span class="line">    <span class="attr">shell:</span> <span class="string">&quot;hostname&quot;</span></span><br><span class="line">    <span class="attr">changed_when:</span> <span class="string">ansible_hostname</span> <span class="string">==</span> <span class="string">&quot;master01&quot;</span></span><br></pre></td></tr></table></figure>
<h1 id="ansible循环"><a href="#ansible循环" class="headerlink" title="ansible循环"></a>ansible循环</h1><p>在Ansible中，循环通常使用<code>loop</code>关键字实现。Ansible支持多种类型的循环，包括：</p>
<table>
<thead>
<tr>
<th>循环类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>loop</code></td>
<td>基本循环，用于遍历列表、字典等</td>
</tr>
<tr>
<td><code>until</code></td>
<td>直到某些条件满足之前循环执行</td>
</tr>
<tr>
<td><code>while</code></td>
<td>在某些条件满足的情况下循环执行</td>
</tr>
<tr>
<td><code>with_*</code></td>
<td>与变量一起使用的特殊循环，例如<code>with_items</code>、<code>with_dict</code>、<code>with_file</code>等</td>
</tr>
</tbody></table>
<p>另外，Ansible还支持嵌套循环和循环控制语句（如<code>break</code>、<code>continue</code>等），可以根据具体情况选择使用。</p>
<h1 id="ansible变量"><a href="#ansible变量" class="headerlink" title="ansible变量"></a>ansible变量</h1><table>
<thead>
<tr>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>字符串</td>
<td>由单引号、双引号或反斜杠括起来的字符序列，可以包含变量或表达式</td>
</tr>
<tr>
<td>数字</td>
<td>整数或浮点数</td>
</tr>
<tr>
<td>布尔值</td>
<td>True 或 False</td>
</tr>
<tr>
<td>列表</td>
<td>由方括号括起来的元素列表，元素可以是任何类型的值，用逗号分隔</td>
</tr>
<tr>
<td>字典</td>
<td>由大括号括起来的键值对，用冒号分隔，键和值之间用等号或空格分隔，键值对之间用逗号分隔</td>
</tr>
<tr>
<td>None</td>
<td>表示空值或未定义值的特殊类型</td>
</tr>
</tbody></table>
<h1 id="Playbooks"><a href="#Playbooks" class="headerlink" title="Playbooks"></a>Playbooks</h1><p>Playboos:简单说就是定义一个配置文件，文件中写入你需要安装的服务，配置文件，变量等信息。可以安装事先定义好的机制完成一个任务</p>
<h2 id="yml脚本语法"><a href="#yml脚本语法" class="headerlink" title="yml脚本语法"></a>yml脚本语法</h2><ul>
<li>文件开头用<code>---</code>开始</li>
<li>在冒号之后，必须存在一个空格</li>
<li>name和模块名称必须对齐</li>
<li>hosts和tasks必须对齐</li>
<li>在书写key和value的时候，不能存在空格</li>
</ul>
<h2 id="playbooks组成部分"><a href="#playbooks组成部分" class="headerlink" title="playbooks组成部分"></a>playbooks组成部分</h2><table>
<thead>
<tr>
<th>目录名称</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>tasks</td>
<td>包含当前角色的所有任务</td>
</tr>
<tr>
<td>handlers</td>
<td>包含当前角色的所有处理程序</td>
</tr>
<tr>
<td>templates</td>
<td>包含当前角色需要使用的模板文件</td>
</tr>
<tr>
<td>files</td>
<td>包含当前角色需要使用的一些文件，这些文件通常是不需要经过模板处理的，如一些二进制文件等</td>
</tr>
<tr>
<td>vars</td>
<td>包含当前角色的变量定义文件</td>
</tr>
<tr>
<td>defaults</td>
<td>包含当前角色的默认变量文件</td>
</tr>
<tr>
<td>meta</td>
<td>包含当前角色的依赖信息，如依赖哪些其它角色等</td>
</tr>
<tr>
<td>library</td>
<td>包含当前角色需要使用的Ansible模块，这些模块通常是需要自行编写的</td>
</tr>
<tr>
<td>module_utils</td>
<td>包含当前角色需要使用的Ansible模块工具库</td>
</tr>
<tr>
<td>lookup_plugins</td>
<td>包含当前角色需要使用的Ansible查找插件</td>
</tr>
<tr>
<td>filter_plugins</td>
<td>包含当前角色需要使用的Ansible过滤器插件</td>
</tr>
<tr>
<td>test</td>
<td>包含当前角色需要使用的Ansible测试模块</td>
</tr>
<tr>
<td>role_name.yml</td>
<td>包含当前角色的主任务文件，可以是多个yml文件，用来定义角色执行时的流程控制</td>
</tr>
</tbody></table>
<h1 id="ansible模块开发"><a href="#ansible模块开发" class="headerlink" title="ansible模块开发"></a>ansible模块开发</h1><h2 id="检查TCP端口"><a href="#检查TCP端口" class="headerlink" title="检查TCP端口"></a>检查TCP端口</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ansible.module_utils.basic <span class="keyword">import</span> AnsibleModule</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    module = AnsibleModule(</span><br><span class="line">        argument_spec=<span class="built_in">dict</span>(</span><br><span class="line">            host=<span class="built_in">dict</span>(<span class="built_in">type</span>=<span class="string">&#x27;str&#x27;</span>, required=<span class="literal">True</span>),</span><br><span class="line">            port=<span class="built_in">dict</span>(<span class="built_in">type</span>=<span class="string">&#x27;int&#x27;</span>, required=<span class="literal">True</span>),</span><br><span class="line">            timeout=<span class="built_in">dict</span>(<span class="built_in">type</span>=<span class="string">&#x27;int&#x27;</span>, default=<span class="number">1</span>),</span><br><span class="line">        ),</span><br><span class="line">        supports_check_mode=<span class="literal">False</span>,</span><br><span class="line">        no_log=<span class="literal">True</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    host = module.params[<span class="string">&#x27;host&#x27;</span>]</span><br><span class="line">    port = module.params[<span class="string">&#x27;port&#x27;</span>]</span><br><span class="line">    timeout = module.params[<span class="string">&#x27;timeout&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    sock.settimeout(timeout)</span><br><span class="line">    result = &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        sock.connect((host, port))</span><br><span class="line">        result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Port &#123;&#125; is open on host &#123;&#125;&quot;</span>.<span class="built_in">format</span>(port, host)</span><br><span class="line">        result[<span class="string">&#x27;rc&#x27;</span>] = <span class="number">0</span></span><br><span class="line">        result[<span class="string">&#x27;status&#x27;</span>] = <span class="string">&#x27;ok&#x27;</span></span><br><span class="line">    <span class="keyword">except</span> socket.error <span class="keyword">as</span> e:</span><br><span class="line">        result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Port &#123;&#125; is not open on host &#123;&#125;: &quot;</span>.<span class="built_in">format</span>(port, host)</span><br><span class="line">        result[<span class="string">&#x27;rc&#x27;</span>] = <span class="number">0</span></span><br><span class="line">        result[<span class="string">&#x27;status&#x27;</span>] = <span class="string">&#x27;failed&#x27;</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        sock.close()</span><br><span class="line"></span><br><span class="line">    module.exit_json(**result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h2 id="调用第三方接口处理数据"><a href="#调用第三方接口处理数据" class="headerlink" title="调用第三方接口处理数据"></a>调用第三方接口处理数据</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> ansible.module_utils.basic <span class="keyword">import</span> AnsibleModule</span><br><span class="line"></span><br><span class="line">logging.basicConfig(level=logging.DEBUG,<span class="built_in">format</span>=<span class="string">&quot;%(asctime)s  %(levelname)s  %(message)s&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">API</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    module = AnsibleModule(</span><br><span class="line">        argument_spec=<span class="built_in">dict</span>(</span><br><span class="line">            host=<span class="built_in">dict</span>(<span class="built_in">type</span>=<span class="string">&#x27;str&#x27;</span>, required=<span class="literal">True</span>),</span><br><span class="line">            login_user=<span class="built_in">dict</span>(<span class="built_in">type</span>=<span class="string">&#x27;str&#x27;</span>, required=<span class="literal">True</span>),</span><br><span class="line">            login_pass=<span class="built_in">dict</span>(<span class="built_in">type</span>=<span class="string">&#x27;str&#x27;</span>, required=<span class="literal">True</span>),</span><br><span class="line">            name=<span class="built_in">dict</span>(<span class="built_in">type</span>=<span class="string">&#x27;str&#x27;</span>, required=<span class="literal">True</span>)</span><br><span class="line">        ),</span><br><span class="line">        supports_check_mode=<span class="literal">False</span>,</span><br><span class="line">        no_log=<span class="literal">True</span></span><br><span class="line">    )</span><br><span class="line">    host = module.params[<span class="string">&#x27;host&#x27;</span>]</span><br><span class="line">    login_user = module.params[<span class="string">&#x27;login_user&#x27;</span>]</span><br><span class="line">    login_pass = module.params[<span class="string">&#x27;login_pass&#x27;</span>]</span><br><span class="line">    name = module.params[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    api = API(host, login_user, login_pass)</span><br><span class="line">    data = api.get_conf(name)</span><br><span class="line">    result = &#123;&#125;</span><br><span class="line">    result[<span class="string">&#x27;stdout&#x27;</span>] = data</span><br><span class="line">    module.exit_json(**result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">慕容峻才</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://www.gbcloud.top/2023/05/10/ansible教程/">http://www.gbcloud.top/2023/05/10/ansible教程/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://www.gbcloud.top">阿才的博客</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Ansible/">Ansible</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2023/05/11/request%E6%A8%A1%E5%9D%97%E5%B0%81%E8%A3%85API/"><i class="fa fa-chevron-left">  </i><span>request模块封装API</span></a></div><div class="next-post pull-right"><a href="/2023/05/09/Jenkins%E6%95%99%E7%A8%8B/"><span>Jenkins教程</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2015 - 2023 By 慕容峻才</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.1"></script><script src="/js/fancybox.js?version=1.9.1"></script><script src="/js/sidebar.js?version=1.9.1"></script><script src="/js/copy.js?version=1.9.1"></script><script src="/js/fireworks.js?version=1.9.1"></script><script src="/js/transition.js?version=1.9.1"></script><script src="/js/scroll.js?version=1.9.1"></script><script src="/js/head.js?version=1.9.1"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>